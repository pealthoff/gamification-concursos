<!doctype html>
<html lang="en">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<head>
  <title>Gamification</title>

  <!-- Bootstrap CSS CDN -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-B4gt1jrGC7Jh4AgE2w7t+o9U3M5nI5ew7F8scXHOB1KYYzkVkv0z7pQhYdRi9g6i4" crossorigin="anonymous">

  <link href="custom/style.css" rel="stylesheet" type="text/css">
  <script type="text/javascript" src="custom/jquery-1.js"></script>
  <script type="text/javascript" src="custom/ui.js"></script>
  <script type="text/javascript" src="custom/custom.js"></script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-222710519-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-222710519-1');
  </script>

</head>

<body class="bg-light">

  <!-- Menu Section -->
  <div id="menu2" class="bg-primary text-white text-center py-3">
    <span class="h3">Gamification</span>
  </div>

  <div id="menu" class="d-flex justify-content-center py-2">
    <!-- Dynamic Menu goes here -->
  </div>

  <!-- Main Navigation -->
  <div id="menu3" class="bg-secondary text-white p-2">
    <div class="container">
      <a href="?" class="text-white">Início</a> |
      <a href="#" id="new" class="text-white">Iniciar nova avaliação</a> |
      <a href="#" id="shu" class="text-white">Randomizar</a> |
      <a href="#" id="result" class="text-white">Conferir resultado</a>
    </div>
  </div>

  <!-- Content Section -->
  <div id="mixed" class="container mt-4">
    <span class="h4">Gamificação</span>
    <ul id="masterList" class="list-group">
      <!-- Dynamic Questions List goes here -->
    </ul>
  </div>

  <!-- Footer Section -->
  <div id="footer" class="bg-dark text-white text-center py-3">
    @railainesantos em <a href="https://github.com/railainesantos/gamification-concursos" class="text-white" target="_blank">GitHub</a>
  </div>

  <!-- Bootstrap JS and dependencies -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy8u8tX2XzB6RvV6nWz9gf6xsIv/k4I8J9ZJqNUm" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js" integrity="sha384-pzjw8f+ua7Kw1TIq0p5dV0kA42cQPR0R/pn65RmxaFqZXFhGRNgnQzvszTH3wSik" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-pzjw8f+ua7Kw1TIq0p5dV0kA42cQPR0R/pn65RmxaFqZXFhGRNgnQzvszTH3wSik" crossorigin="anonymous"></script>

  <script>
    var json = {};
    var url = "https://api.npoint.io/aed2b7d20ce08f97cae8"; //var url = "https://www.npoint.io/docs/aed2b7d20ce08f97cae8";
    $(document).ready(function() {  
         $.getJSON(url, 
              function(data) { json = data; writeQuestions(); }
         ); 
    }); 
     
    function writeQuestions() { 
      $( document ).ready(function() {

          let html = "";
          param_disciplina = $.urlParam('disciplina');                    
          param_assunto = $.urlParam('assunto');
          let encoded_param_disciplina = encodeURI(param_disciplina);
          let encoded_param_assunto = encodeURI(param_assunto);
          if ((param_disciplina != null )){
            var disciplina = json.disciplinas.find(el => el.nome === encoded_param_disciplina);
          }
          if ((param_assunto != null )){
            var assunto = disciplina.assuntos.find(el => el.nome === encoded_param_assunto);    
          }
      
          if ( param_disciplina == null ){
              $.each(json.disciplinas, function (index, item) {
                html += "<a href=\"" + "\?disciplina=" + (item.nome) + "\" class=\"btn btn-link\">" + (item.nome.toUpperCase()) + "</a>";
                html += " | ";
              });
          } else if (( param_disciplina != null )){
            var disciplina = json.disciplinas.find(el => el.nome === encoded_param_disciplina);
              $.each(disciplina.assuntos, function (index, item) {
                html += "<a href=\"" + "\?disciplina=" + encoded_param_disciplina + "&"+ "assunto=" + (item.nome) +"\" class=\"btn btn-link\">" + (item.nome.toUpperCase()) + "</a>";
                html += " | ";
              });
          }

          $("#menu").append(html);

          if ((param_disciplina != null ) && (param_assunto != null )){
              if (param_assunto != null){    
                $.each(assunto.topicos, function (index, item) {
                  $("#masterList").append("<div class=\"panel panel-default mb-3\"> <div class=\"panel-heading\"><span class=\"h5\">" + (item.nome.toUpperCase()) + "</span></div> <ul id=\""+ (index+1) + "\" class=\"list-group\"><li class=\"list-group-item unmovable\"></li></ul></div>");       
                });
              };

            var list='';
            if (assunto != null){
              $.each(assunto.topicos, function (index, topico) {
               $.each(topico.itens, function (index_2, item) {
                  list+="<li class=\"list-group-item\" id=\""+ (index+1) + (index_2+1) +"\">" + (item.nome.toUpperCase()) + "</li>";
                });            
              });
            };

            $('#0').append(list);
            $('#0').find('.correct').each(function(){
              $(this).parent().css('background','#E7E7E7');
              $(this).remove();
            });
            $("#masterList").sortable({ items: "li", handle:'.containerTitle', opacity: 0.6, helper: 'clone', forcePlaceholderSize: true,forceHelperSize: true});
          };
        });
    };

  </script>

</body>
</html>
